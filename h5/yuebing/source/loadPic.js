eval(function(p,a,c,k,e,r){e=function(c){return(c<62?'':e(parseInt(c/62)))+((c=c%62)>35?String.fromCharCode(c+29):c.toString(36))};if('0'.replace(0,e)==0){while(c--)r[e(c)]=k[c];k=[function(e){return r[e]||e}];e=function(){return'([4689zE]|1\\w)'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(6(){6 k(a){4.f=4.1r=a.1r||1y.createElement("1r");4.f.z=a.z||800;4.f.11=a.11||600;4.b=a.z;4.d=a.11;4.o=4.f.getContext("2d");4.8=a.8||1;4.L=a.L||!1;4.1k=a.1k;4.x=a.x||0;4.y=a.y||0;4.k=1a l;4.U=6(){12 a,c,d;4.b/4.d<4.a.z/4.a.11&&4.L?(a=4.d/4.a.11,c=(4.b-4.a.z*a)/2,d=0):(a=4.b/4.a.z,c=0,d=(4.d-4.a.11*a)/2);4.i(a,c,d)}.13(4);4.Z()}6 l(a,b,c,d,e,f){4.B=9;a&&b&&c&&4.l(a,b,c,d,e,f)}(6(){1s(12 a=0,b=["webkit","moz"],c=0;c<b.1d&&!15.1i;++c)15.1i=15[b[c]+"RequestAnimationFrame"],15.1l=15[b[c]+"CancelAnimationFrame"]||15[b[c]+"CancelRequestAnimationFrame"];15.1i||(15.1i=6(b){12 c=(1a 1j).getTime(),f=1b.max(0,30-(c-a)),h=15.setTimeout(6(){b(c+f)},f);a=c+f;1f h});15.1l||(15.1l=6(a){1z(a)})})();k.1t={s:3,n:9,q:9,v:9,I:9,14:-1,g:9,1A:6(a){if(!(a==4.14||0>a||a>=4.g.1d)){4.14=a;12 b,c,d;b=4.g[a];a<4.g.1d-1&&(d=4.g[a+1]);0<a&&(c=4.g[a-1]);4.X(b);4.H(c);4.G(d)}},1B:6(){4.e&&(4.c=4.a,4.w=4.y,4.h=4.8,4.14++,4.a=4.e,4.y=4.t,4.x=4.c.z*4.h+4.x,4.8=4.j,4.14<4.g.1d-1?4.G(4.g[4.14+1]):4.e=9,4.k.l({x:4.x},{x:0},6(a){4.i(4.8,a.x,4.y)}.13(4),1C,9,6(){4.H(4.g[4.14-1])}.13(4)))},Y:6(){4.c&&(4.e=4.a,4.t=4.y,4.j=4.8,4.14--,4.a=4.c,4.y=4.w,4.x=4.x-4.c.z*4.h-4.b/10,4.8=4.h,0<4.14?4.H(4.g[4.14-1]):4.c=9,4.k.l({x:4.x},{x:0},6(a){4.i(4.8,a.x,4.y)}.13(4),1C,9,6(){4.G(4.g[4.14+1])}.13(4)))},F:6(a,b){if("1D"==1e a)b.17=a;1m if(a.V||!a.1n)b.17=a.17;1m{b.17=a.1n;12 c=1a 1o;c.1g=6(){b.17=a.17;a.V=!0};c.17=a.17}},X:6(a){4.a=1a 1o;4.a.1g=4.U;4.F(a,4.a)},H:6(a){a?(4.h=4.w=4.N=9,4.c=1a 1o,4.c.1g=6(){4.c&&(4.h=4.b/4.c.z,4.w=4.c.11*4.h<4.d?(4.d-4.c.11*4.h)/2:0)}.13(4),4.F(a,4.c)):(4.c&&(4.c.1g=9),4.c=9)},G:6(a){a?(4.j=4.t=4.M=9,4.e=1a 1o,4.e.1g=6(){4.e&&(4.j=4.b/4.e.z,4.t=4.e.11*4.j<4.d?(4.d-4.e.11*4.j)/2:0)}.13(4),4.F(a,4.e)):(4.e&&(4.e.1g=9),4.e=9)},Z:6(){12 a=9,b=9,c=9,d=9,e=9,f=9,h=9,m=9,k,r,l="mousedown",x="mousemove",y="mouseup";void 0!==1y.ontouchstart&&(l="touchstart",x="touchmove",y="touchend");4.f.1u(l,6(g){4.$=1a 1j;4.O=!1;4.k.1E();g.1v();m=4.8;g.E||(g.E=[{18:g.18,19:g.19}]);a=g.E[0].18-4.f.1c().1h;b=g.E[0].19-4.f.1c().1p;2==g.E.1d?(c=g.E[1].18-4.f.1c().1h,d=g.E[1].19-4.f.1c().1p,e=a+(c-a)/2,f=b+(d-b)/2,h=1b.1F(1b.1q(c-a,2)+1b.1q(d-b,2))):(e=a,f=b,h=0);k=e-4.x;r=f-4.y;4.n=g.E[0].18;4.q=g.E[0].19;4.a.z*4.8<=4.b&&(4.D=4.C=!0)}.13(4),!1);12 p=9,q=9,s=9,t=9,u=9,v=9,w=9;4.f.1u(x,6(a){a.1v();if(9!==h){a.E||(a.E=[{18:a.18,19:a.19}]);4.O=!0;12 b=4.8,c,d;p=a.E[0].18-4.f.1c().1h;q=a.E[0].19-4.f.1c().1p;2==a.E.1d?(s=a.E[1].18-4.f.1c().1h,t=a.E[1].19-4.f.1c().1p,u=p+(s-p)/2,v=q+(t-q)/2,w=1b.1F(1b.1q(s-p,2)+1b.1q(t-q,2)),b=m*(w/h||1)):(u=p,v=q,w=0);b*4.a.z<4.b?b-=.7*(b-4.b/4.a.z):b*4.a.z>4.b*4.s&&(b-=.7*(b-4.b*4.s/4.a.z));c=u-k/m*b;d=v-r/m*b;4.v=4.n;4.I=4.q;4.n=a.E[0].18;4.q=a.E[0].19;a=4.u(b,c,d);a.x!=c&&(!(0<c)||4.c&&4.C?!(0>c)||4.e&&4.D||(c=a.x+.3*(c-a.x)):c=a.x+.3*(c-a.x));a.y!=d&&(d=a.y+.3*(d-a.y));4.i(b,c,d)}}.13(4),!1);4.f.1u(y,6(a){a.1v();if(0==4.O&&1E3>1a 1j-4.$&&"6"==1e 4.1k)4.1k(4.14);a.E||(a.E=[]);1==a.E.1d?(d=c=9,e=a.E[0].18-4.f.1c().1h,f=a.E[0].19-4.f.1c().1h,k=e-4.x,r=f-4.y,m=4.8,h=0):(h=f=e=9,4.aa(a))}.13(4),!1)},aa:6(){12 a={},b={};if(4.8*4.a.z<4.b)a.8=4.8,b.8=4.b/4.a.z,a.x=4.x,b.x=0,a.y=4.y,b.y=b.8/a.8*(4.y-4.d/2)+4.d/2,0<b.y&&(b.y=0),4.k.l(a,b,6(a){4.i(a.8,a.x,a.y)}.13(4),1w);1m if(4.8*4.a.z>4.b*4.s)a.8=4.8,b.8=4.b/4.a.z*4.s,a.x=4.x,b.x=b.8/a.8*(4.x-4.b/2)+4.b/2,a.y=4.y,b.y=b.8/a.8*(4.y-4.d/2)+4.d/2,b=4.u(b.8,b.x,b.y),4.k.l(a,b,6(a){4.i(a.8,a.x,a.y)}.13(4),1w);1m if(9!==4.n&&9!==4.v){12 c=4.n-4.v,d=4.q-4.I;a.x=4.x;a.y=4.y;12 e=4.b/3,f=4.b/50,h=4.u(4.8,a.x,a.y);4.a.z*4.8>=4.b&&(4.D=4.C=!1,0<=4.x&&(4.C=!0),4.x<=-1b.floor(4.a.z*4.8-4.b)&&(4.D=!0));if(h.x!=a.x&&(1b.1H(c)>f&&4.a.z*4.8<=4.b&&4.a.11*4.8<=4.d||1b.1H(a.x-h.x)>e)){if(0<a.x&&4.c){4.Y();1f}if(0>a.x&&4.e){4.1B();1f}}b.x=4.x+5*c;b.y=4.y+5*d;b=4.u(4.8,b.x,b.y);4.k.l(a,b,6(a){4.i(4.8,a.x,a.y)}.13(4),1w,9)}4.I=4.v=4.q=4.n=9},u:6(a,b,c){12 d={};d.8=a;d.x=b;d.y=c;0<b?d.x=0:b<-(4.a.z*a-4.b)&&(d.x=-4.a.z*a+4.b);4.a.11*a<4.d?d.y=(4.d-4.a.11*a)/2:0<c?d.y=0:c<-(4.a.11*a-4.d)&&(d.y=-4.a.11*a+4.d);1f d},i:6(a,b,c){4.a.11*a<4.d&&(c=(4.d-4.a.11*a)/2);4.8=a;4.x=b;4.y=c;4.o.fillStyle="#000";4.o.fillRect(0,0,4.b,4.d);4.o.1x(4.a,b,c,a*4.a.z,4.8*4.a.11);4.x>4.b/10&&4.c&&(4.N=-4.c.z*4.h+4.x-4.b/10,4.o.1x(4.c,4.N,4.w,4.h*4.c.z,4.h*4.c.11));4.x<-(4.a.z*4.8-4.b)-4.b/10&&4.e&&(4.M=4.x+4.a.z*4.8+4.b/10,4.o.1x(4.e,4.M,4.t,4.j*4.e.z,4.j*4.e.11))}};k.1t.setImages=6(a,b){if(a.1d){4.g=[];1s(12 c,d=0;d<a.1d;d++)c="1D"===1e a[d]?{17:a[d]}:{17:a[d].17,1n:a[d].1n},4.g.push(c);4.14=-1;4.1A(parseInt(b)||0)}};l.1t={l:6(a,b,c,d,e,f){a&&b&&"6"==1e c&&(4.A=a,4.p=b,4.K=c,4.P=d||3E3,4.m=f,4.T="6"===1e e?e:"easeInOut"==e?4.r.R:"easeIn"==e?4.r.Q:"linear"==e?4.r.W:4.r.S,1z(4.B),4.1I=1a 1j,4.J())},J:6(){12 a=4,b={},c=1a 1j-4.1I;1s(n in 4.A)"1J"==1e 4.A[n]&&"1J"==1e 4.p[n]&&(b[n]=4.T(c,4.A[n],4.p[n]-4.A[n],4.P));c>=4.P?(4.K(4.p),"6"==1e 4.m&&(4.m(4.p),4.m=9)):(4.K(b),4.B=1i(6(){a.J()}))},1E:6(){1l(4.B);"6"==1e 4.m&&(4.m(4.p),4.m=9)},r:{Q:6(a,b,c,d){1f c*(a/=d)*a+b},S:6(a,b,c,d){1f-c*(a/=d)*(a-2)+b},R:6(a,b,c,d){1f 1>(a/=d/2)?c/2*a*a+b:-c/2*(a*(a-2)-1)+b},W:6(a,b,c,d){1f c*a/d+b}}};15.TouchPhotos=k})();',[],108,'||||this||function||scale|null||||||||||||||||||||||||||width|||||targetTouches|||||||||||||||||||||||height|var|bind|index|window||src|pageX|pageY|new|Math|getBoundingClientRect|length|typeof|return|onload|left|requestAnimationFrame|Date|onclick|cancelAnimationFrame|else|small|Image|top|pow|canvas|for|prototype|addEventListener|preventDefault|300|drawImage|document|clearTimeout|select|next|200|string|clear|sqrt||abs|startTime|number'.split('|'),0,{}));

(function(){
	var iOS = navigator.userAgent.match(/ OS (\d+).*? Mac OS/) || false;
	var isAndroid = (/android/i).test(navigator.userAgent) || false;
	function Q(s, p){
		return (p || document).querySelector(s);
	};
	function QA(s, p){
		return (p || document).querySelectorAll(s);
	};
	var viewScale;
	var viewWidth, 
		viewHeight = document.documentElement.clientHeight,
		viewScale;
	if(document.documentElement.clientWidth / document.documentElement.clientHeight > 0.76){
		viewWidth = Math.round(document.documentElement.clientHeight / 416 * 320);
		viewScale = viewWidth / 640;
	}else{
		viewScale = document.documentElement.clientWidth / 640;
	};
	
	document.documentElement.style.fontSize = 32 * viewScale + 'px';
	viewWidth = document.documentElement.clientWidth;
	viewHeight = document.documentElement.clientHeight;
	function absPosition(obj, parentObj){ //位置
		var left = 0, top = 0, tempObj = obj;
		try{
			while(tempObj!= null && tempObj!=document.body && tempObj!=document.documentElement && tempObj != parentObj){
				left += tempObj.offsetLeft;
				top += tempObj.offsetTop;
				tempObj = tempObj.offsetParent;
			};
		}catch(e){};
		return {left:left,top:top};
	};
	var touchPhotos = new TouchPhotos({
		canvas : Q('#photosCanvas'),
		width : viewWidth,
		height : viewHeight,
		onclick : function(){
			touchPhotos.canvas.className = 'canvasHide';
			setTimeout(function(){
				touchPhotos.canvas.className = '';
			}, 300);
		}
	});
	document.body.appendChild(touchPhotos.canvas);

	var contList = [];
	var page = 1;
	var pageSize = 10;
	var pos = absPosition(Q('#bottom'));
	window.onload = function(){
		pos = absPosition(Q('#bottom'));
	};
	loadCont();

	var updateTimer;

	//图文
	function loadCont(){
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				if(!xhr.responseText){
					Q('#content').innerHTML = '<div class="c_txt" style="text-align:center;padding:6em 0 0;">直播还未开始，等一下再来吧：）</div>';
					updateTimer = setInterval(checkUpdate, 15000);
					return;
				}
				var data = eval('(' + xhr.responseText + ')');
				if(data && data.length){
					var html = '';
					for (var i = 0; i < data.length; i++){
						contList.push(data[i]);
						html += getItemHTML(data[i]);
					}
					if(contList.length >= pageSize){
						//滚动加载
						window.onscroll = function(){
							pos = absPosition(Q('#bottom'));
							if(window.pageYOffset + document.documentElement.clientHeight >= pos.top){
								loadMove();
							}
						}
					};
					Q('#content').innerHTML = html;
					
					formatPic();
				}else{
					Q('#content').innerHTML = '<div class="c_txt" style="text-align:center;padding:6em 0 0;">直播还未开始，等一下再来吧：）</div>'
				};
				//自动更新
				updateTimer = setInterval(checkUpdate, 15000);
			};
		};
		xhr.ontimeout = function(e){
			Q('#content').innerHTML = '网络超时';
		}
		xhr.open('GET', dataAPI + '&perNum=' + pageSize + '&pageNo=' + page, true);
		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhr.send();
	};
	//载入更多
	var isEnd = false;
	function loadMove(){
		if(isEnd){return};
		page ++;
		Q('#bottom').innerHTML = '载入中...';
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				if(!xhr.responseText){
					window.onscroll = null;
					isEnd = true;
					return;
				}
				var data = eval('(' + xhr.responseText + ')');
				if(data && data.length){
					if(data.length < pageSize){
						window.onscroll = null;
						isEnd = true;
					};
					var html = '';
					for (var i = 0; i < data.length; i++){
						contList.push(data[i]);
						html += getItemHTML(data[i]);
					}
					var div = document.createElement('div');
					Q('#content').appendChild(div);
					div.innerHTML = html;
					Q('#bottom').innerHTML = '';
					formatPic();
				}else{
					window.onscroll = null;
					isEnd = true;
				};
			};
		};
		
		xhr.open('GET', dataAPI + '&perNum=' + pageSize + '&pageNo=' + page, true);
		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhr.send();
	};

	//检测更新
	function checkUpdate(){
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				if(!xhr.responseText){
					return;
				}
				var data = eval('(' + xhr.responseText + ')');
				if(data && data.length){
					if(contList.length == 0){
						Q('#content').innerHTML = '';
					};
					var html = '';
					for (var i = 0; i < data.length; i++){
						if(!selectPkId(data[i].pkId)){
							contList.push(data[i]);
							html += getItemHTML(data[i]);
						}
					}
					if(html){
						var div = document.createElement('div');

						Q('#content').insertBefore(div, Q('#content').firstChild);
						div.innerHTML = html;

						formatPic();
					};
				};
			};
		};
		xhr.open('GET', dataAPI + '&perNum=' + pageSize, true);
		xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhr.send();
	};
	function selectPkId(pkId){
		for (var i = 0; i < contList.length; i++) {
			if(contList[i].pkId == pkId){
				return contList[i];
			}
		};
	}

	function getItemHTML(item){
		var imgPath = 'http://i0.peopleurl.cn/';
		var time = new Date(parseInt(item.imgTime));
		var date = time.getDate(),
			month = time.getMonth()+1,
			hours = time.getHours(),
			minutes = time.getMinutes(),
			seconds = time.getSeconds();

		var html = '<dl>' +
			'<dt><span class="time">' + (item.nickName?(item.nickName + ' '):'') + month + '月' + date + '日 ' + (hours<10?'0' + hours:hours) + ':' + (minutes<10?'0' + minutes:minutes) + ':' + (seconds<10?'0' + seconds:seconds) + '</span></dt>' +
			'<dd>' +
				'<div class="list_arr"><span class="line_arr_line1">◆</span><span class="line_arr_line2">◆</span></div>';
			if(item.content){
				html += '<div class="c_txt">' + (item.content.replace(/</g, '&lt;')) + '</div>';
			}
			if(item.imgSmallPath){
				html += '<div class="c_pic"><img src="'+ imgPath + item.imgSmallPath +'" data-src="'+ imgPath + item.imgBigPath +'" alt=""></div>';
			}
			html += '</dd>' +
		'</dl>';

		return html;
	};

	//格式化图片
	var imgData;
	var imgClickFn = function(){
		touchPhotos.setImages(imgData, this.getAttribute('data-index'));
		touchPhotos.canvas.className = 'canvasShow';
	};
	function formatPic(){
		imgData = [];
		var imgs = QA('img', Q('#content'));
		for (var i = 0; i < imgs.length; i++) {
			imgData.push({src: imgs[i].getAttribute('data-src'), small: imgs[i].src});
			imgs[i].setAttribute('data-index', i);
			imgs[i].onclick = imgClickFn;
		};
	}

})();

var img = new Image();
img.src = 'images/icon.jpg';
img.style.position = 'absolute';
img.style.top = '-1000px';
img.style.left = '-1000px';
document.body.insertBefore(img, document.body.firstChild);
